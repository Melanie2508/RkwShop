{namespace rkwShop=RKW\RkwShop\ViewHelpers}

<ul class="order-list">

	<f:for each="{products}" as="product" iteration="productIterator">

		<li class="order-list__item">

            <f:if condition="{product.image}" >
                <f:then>
                    <figure class="order-list__image">
                        <f:cObject typoscriptObjectPath="plugin.tx_rkwshop.libs.responsiveThumbnail" data="{product.image.uid}"/>
                    </figure>
                </f:then>
                <f:else>
                    <figure class="order-list__image order-list__image--cover">
                        <f:if condition="{product.download}" >
                            <f:then>
                                <f:cObject typoscriptObjectPath="plugin.tx_rkwshop.libs.responsiveThumbnail" data="{product.download.uid}"/>
                            </f:then>
                            <f:else>
                                <f:cObject typoscriptObjectPath="plugin.tx_rkwshop.libs.responsiveThumbnail" data="EXT:rkw_shop/Resources/Public/Images/publications-fallback.jpg"/>
                            </f:else>
                        </f:if>
                    </figure>
                </f:else>
            </f:if>

			<div class="order-list__details">
				<h4 class="order-list__title">{product.title}</h4>
				<f:if condition="{product.subtitle}">
					<p class="order-list__subtitle">{product.subtitle}</p>
				</f:if>

                <f:if condition="{product.recordType} == '\RKW\RkwShop\Domain\Model\ProductBundle'">

                    <!-- is bundle itself? -->
                    <f:then>
                        <f:render partial="Order/Form/ProductList/BundleOptions" section="isBundle" arguments="{product: product, orderItem: order.orderItem}" />
                    </f:then>

                    <!-- belongs to bundle? -->
                    <f:else>

                        <f:if condition="{product.productBundle.uid} > 0">
                            <f:then>

                                <!-- is single order allowed? -->
                                <f:if condition="{product.productBundle.allowSingleOrder}">
                                    <f:render partial="Order/Form/ProductList/Input" arguments="{product: product, orderItem: order.orderItem}" />
                                </f:if>

                                <f:render partial="Order/Form/ProductList/BundleOptions" section="belongsToBundle" arguments="{product: product, orderItem: order.orderItem}" />
                            </f:then>

                            <!-- without bundle -->
                            <f:else>
                                <f:render partial="Order/Form/ProductList/Input" arguments="{product: product, orderItem: order.orderItem}" />
                            </f:else>
                        </f:if>

                    </f:else>
                </f:if>
			</div>
		</li>
	</f:for>
</ul>
