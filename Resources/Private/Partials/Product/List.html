{namespace rkwShop=RKW\RkwShop\ViewHelpers}

<f:if condition="<f:count>{productList}</f:count>">

    <div class="order-list">

        <f:for each="{productList}" as="product" iteration="productIterator">

            <div class="order-list__item">
                <f:render partial="Order/Form/ProductList/ProductImage" arguments="{product: product}" />

                <div class="order-list__details">
                    <f:link.action action="show" controller="Product" pluginName="ProductDetail" extensionName="RkwShop" pageUid="{showPid}" arguments="{product : product}" title="{product.title}">
                        <h4 class="order-list__title">{product.title} <f:if condition="{product.sku}">- <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.sku" arguments="{0: '{product.sku}'}"/></f:if></h4>
                    </f:link.action>
                    <p>{product.productType.model}</p>
                    <f:if condition="{product.subtitle}">
                        <p class="order-list__subtitle">{product.subtitle}</p>
                    </f:if>
                    <f:if condition="{product.edition}">
                        <p class="order-list__subtitle">{product.edition}</p>
                    </f:if>

                    <!-- product is a standalone product -->
                    <f:comment>
                        <f:if condition="{product.productType.model} == '\\RKW\\RkwShop\\Domain\\Model\\Product'">
                            <p>standalone</p>
                        </f:if>
                    </f:comment>

                    <f:if condition="<rkwShop:ProductStock product='{product}' />">
                        <f:then>
                            <p class="order-list__{f:format.case(mode: 'lower', value: '{product.productType.title}')} order-list__status">
                                <!-- @todo: Wann soll das eingesetzt werden? Geht eigentlich nur um Abverkauf, wenn ich weiß, wie der tatsächliche aktuelle Bestand ist!!!-->
                                <f:comment>
                                    <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.input.stockLeft" arguments="{0: '{rkwShop:ProductStock(product: product)}'}"/>
                                </f:comment>
                                <!-- /@todo -->

                                <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.input.inStock" />
                            </p>
                        </f:then>
                        <f:else>
                            <p class="order-list__{f:format.case(mode: 'lower', value: '{product.productType.title}')} order-list__status order-list__status--warn">
                                <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.input.outOfStock" />
                            </p>
                        </f:else>
                    </f:if>

                    <!-- product is of type collection -->
                    <f:if condition="<f:count>{product.childProducts}</f:count>">
                        <f:render partial="Product/List/BundleOptions" section="isBundle" arguments="{product: product, showPid: showPid}" />
                    </f:if>

                    <!-- product is part of collection product -->
                    <f:if condition="<f:count>{product.parentProducts}</f:count>">

                        <f:for each="{product.parentProducts}" as="parentProduct">

                            <f:if condition="{parentProduct.productType.model} instanceof '\RKW\RkwShop\Domain\Model\ProductBundle'">
                                <f:render partial="Product/List/BundleOptions" section="belongsToBundle" arguments="{product: parentProduct, showPid: showPid}" />
                            </f:if>

                        </f:for>
                    </f:if>





                    <!-- to be used -->
                    <f:comment>
                    <f:if condition="<rkwShop:ProductStock product='{product}' />">
                        <f:then>
                            <p class="order-list__status">
                                <f:comment>
                                    <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.input.stockLeft" arguments="{0: '{rkwShop:ProductStock(product: product)}'}"/>
                                </f:comment>
                                <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.input.inStock" />
                            </p>
                        </f:then>
                        <f:else>
                            <!-- @todo: implement preorder -->
                            <f:if condition="<rkwShop:ProductStock product='{product}' preOrder='1' />">
                                <f:then>
                                    <p class="order-list__status order-list__status--warn">
                                        <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.input.outOfStockPreOrder" />
                                    </p>
                                </f:then>
                                <f:else>
                                    <p class="order-list__status order-list__status--warn">
                                        <f:translate key="LLL:EXT:rkw_shop/Resources/Private/Language/locallang.xlf:partials.order.form.productList.input.outOfStock" />
                                    </p>
                                </f:else>
                            </f:if>
                        </f:else>
                    </f:if>
                    </f:comment>


                </div>

            </div>

        </f:for>

    </div>

</f:if>

<!-- lazy loading / load more box -->
<f:render partial="Product/List/MoreLink" arguments="{_all}" />
